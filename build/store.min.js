!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.JSONStore=t()}}(function(){return function t(e,r,i){function a(s,o){if(!r[s]){if(!e[s]){var h="function"==typeof require&&require;if(!o&&h)return h(s,!0);if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};e[s][0].call(u.exports,function(t){var r=e[s][1][t];return a(r?r:t)},u,u.exports,t,e,r,i)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(t,e,r){"use strict";function i(t){t=t||{},this.initialOptions=a.copy(t);var e=t.store,r=t.copyStore!==!1;this.store=r?a.copy(e):e,this.cacheKeys=this._getCacheKeysMap(t),this.cacheKeyPrefix=t.cacheKeyPrefix||c,this.localStorage=t.localStorage,this.patches=[],this.relativePatches=[],this.backPatches=[],this.currentPath=[],this.isDoing=!1,this.pathListener=new h}var a=t("./utils"),n=t("./array"),s=t("./object"),o=t("./patch"),h=t("./PathListener"),c="JSON_STORE_CACHE_KEY_PREFIX",u=function(){};i.prototype={_storeUpdated:function(t){this._updateCache(t[0]),this.pathListener.checkPath(t,this.store)},_getCacheKeysMap:function(t){var e={};return"array"===a.type(t.cacheKeys)&&t.cacheKeys.forEach(function(r){Object.hasOwnProperty.call(t.store,r)&&(e[r]=!0)}),e},_getRef:function(t){for(var e=this.store,r=0,i=t.length;r<i;r++)e=e[t[r]];return e},_detectPath:function(t){for(var e,r,i,o=[],h=this.store,c=0,u=t.length;c<u;c++)if(e=t[c],r=a.type(e),i=a.type(h),"object"===i)if(s.hasOwnProperty.call(e,"__value")){var p=s.getObjectKeyByValue(h,e.__value);if(!p)return[];h=h[p],o.push(p)}else{if(!s.hasOwnProperty.call(h,e))return[];h=h[e],o.push(e)}else if("array"===i)if(s.hasOwnProperty.call(e,"__value")){var f=n.getArrayIndexByValue(h,e.__value);if(!(f>-1))return[];h=h[f],o.push(f)}else{if(!s.hasOwnProperty.call(h,e))return[];h=h[e],o.push(e)}return o},_formatPath:function(t,e){var r=a.type(t);if("undefined"===r||"null"===r?t=[]:"array"!==r&&(t=[t]),e!==!1){var i=this._detectPath(t);return i.length===t.length?i:null}return t},_moveArrayItem:function(t,e){var r=this._getFullPath(t);if(!r||r.length<1)return this;var i=r.pop(),s=this._getRef(r);if("array"!==a.type(s))return this;var h=e===!0?"createMoveUp":"createMoveDown",c="createMoveUp"===h?"createMoveDown":"createMoveUp";return this.isDoing&&(this.patches.push(o[h](r.concat(i))),this.relativePatches.push(o[h](this._getRelativePath(r.concat(i)))),(e===!0&&i>0||e!==!0&&i<s.length-1)&&this.backPatches.unshift(o[c](r.concat(e===!0?i-1:i+1)))),e===!0?n.moveArrayItemUp(s,i):n.moveArrayItemDown(s,i),this._storeUpdated(t),this},_getFullPath:function(t){if(a.isReferenceType(t)&&t.isFull)return t;var e=this._formatPath(this.currentPath,!1),r=e.concat(this._formatPath(t,!1)),i=this._formatPath(r);return i&&(i.isFull=!0),i},_getRelativePath:function(t){return t.slice(this.currentPath.length)},_composeCacheKey:function(t){return this.cacheKeyPrefix+"@"+t},_updateCache:function(t){this.cacheKeys[t]&&this.localStorage&&"function"==typeof this.localStorage.setItem&&this.localStorage.setItem(this._composeCacheKey(t),this.get(t))},registerPathListener:function(t,e,r){this.pathListener.registerListener(t,e,r)},removeListenerByPath:function(t,e){this.pathListener.removeListenerByPath(t,e)},removeListenerByGroup:function(t){this.pathListener.removeListenerByGroup(t)},loadCache:function(t,e){var r=this;if(e="function"==typeof e?e:u,this.localStorage&&"function"==typeof this.localStorage.multiGet){var i=this.initialOptions.cacheKeys||[],a=i.map(function(t){return r._composeCacheKey(t)});this.localStorage.multiGet(a,function(e){var n={};a.forEach(function(t,a){var s=i[a],o=e[t];r.set(s,null===o?r.get(s):o),n[s]=e[t]}),t(n)},e)}else e("localStorage is undefined")},reInit:function(t){return i.call(this,t||this.initialOptions),this},goTo:function(t,e){if(!this.isDoing)throw new Error("You are using store.goTo outside store.do!");return e===!0?this.currentPath=this._getFullPath(t):this.currentPath=this._formatPath(t),this},do:function(t,e,r,i,a,n,s,o){var h={};if(this.isDoing=!0,"function"==typeof t)t(this,e,r,i,a,n,s,o);else{if("function"!=typeof e)throw new Error("Invalid parameter action.");e(this,r,i,a,n,s,o)}return h.patches=this.patches,h.relativePatches=this.relativePatches,h.backPatches=this.backPatches,this.patches=[],this.relativePatches=[],this.backPatches=[],this.currentPath=[],this.isDoing=!1,h},add:function(t,e,r){var i,s;if(t=this._getFullPath(t),!t||!a.isReferenceType(i=this._getRef(t))||"object"===(s=a.type(i))&&!a.isCommonKeyType(r))return this;if(this.isDoing&&(this.patches.push(o.createAdd(t,e,r)),this.relativePatches.push(o.createAdd(this._getRelativePath(t),e,r)),"object"===s?this.backPatches.unshift(o.createRemove(t.concat(r))):this.backPatches.unshift(o.createUpdate(t,this.get(t),!0))),"object"===s)i[r]=e;else{var h=n.parseArrayIndex(r);void 0!==h?i.splice(h,0,e):i.push(e)}return this._storeUpdated(t),this},remove:function(t){if(!(t=this._getFullPath(t)))return this;if(this.isDoing&&(this.patches.push(o.createRemove(t)),this.relativePatches.push(o.createRemove(this._getRelativePath(t))),this.backPatches.unshift(o.createUpdate(t,this.get(t),!0))),t.length<1)return this.store=void 0,this;var e=t.pop(),r=this._getRef(t),i=a.type(r);return"array"===i?r.splice(e,1):"object"===i&&delete r[e],this._storeUpdated(t),this},update:function(t,e,r){t=this._formatPath(t,!1);var i,a=this._getFullPath(t);return a?(this.isDoing&&(this.patches.push(o.createUpdate(a,e)),this.relativePatches.push(o.createUpdate(this._getRelativePath(a),e)),this.backPatches.unshift(o.createUpdate(a,this.get(a)))),i=a.pop(),void 0!==i?this._getRef(a)[i]=e:this.store=e,this._storeUpdated(t),this):r===!0&&t.length>0?(i=t.pop(),this.add(t,e,i)):this},set:function(t,e){return this.update(t,e,!0)},moveUp:function(t){return this._moveArrayItem(t,!0)},moveDown:function(t){return this._moveArrayItem(t)},moveTo:function(t,e,r){return t=this._getFullPath(t),e=this._getFullPath(e),t&&e&&a.isReferenceType(this._getRef(e))?(this.add(e,this._getRef(t),r),this.remove(t),this):this},exchange:function(t,e){if(t=this._getFullPath(t),e=this._getFullPath(e),t&&e){var r=this._getRef(t),i=this.get(e);this.update(t,i),this.update(e,r)}return this},extendObject:function(t,e,r,i,n,h,c){var u;return(t=this._getFullPath(t))&&"object"===a.type(u=this._getRef(t))?(this.isDoing&&(this.patches.push(o.createExtendObject.apply(this,arguments)),this.relativePatches.push(o.createExtendObject(this._getRelativePath(t),e,r,i,n,h,c)),this.backPatches.push(o.createUpdate(t,this.get(t)))),s.extend(u,e,r,i,n,h,c),this._storeUpdated(t),this):this},spreadArray:function(t,e,r,i,s){var h;return(t=this._getFullPath(t))&&"array"===a.type(h=this._getRef(t))?(e="number"==typeof e?e:h.length,"number"!==a.type(e)?this:(this.isDoing&&(this.patches.push(o.createSpreadArray(t,e,r,i,s)),this.relativePatches.push(o.createSpreadArray(this._getRelativePath(t),e,r,i,s)),this.backPatches.unshift(o.createUpdate(t,this.get(t)))),n.spreadArray(h,e,r,i,s),this._storeUpdated(t),this)):this},spread2dArrayRow:function(t,e,r,i,s){var h;return(t=this._getFullPath(t))&&n.is2dArray(h=this._getRef(t))&&"number"===a.type(e)?(e="number"==typeof e?e:h.length,"number"!==a.type(e)?this:(this.isDoing&&(this.patches.push(o.createSpread2dArrayRow(t,e,r,i,s)),this.relativePatches.push(o.createSpread2dArrayRow(this._getRelativePath(t),e,r,i,s)),this.backPatches.unshift(o.createUpdate(t,this.get(t)))),n.spread2dArrayRow(h,e,r,i,s),this._storeUpdated(t),this)):this},spread2dArrayCol:function(t,e,r,i,s){var h;return(t=this._getFullPath(t))&&n.is2dArray(h=this._getRef(t))&&"number"===a.type(e)?(e="number"==typeof e?e:h[0].length,"number"!==a.type(e)?this:(this.isDoing&&(this.patches.push(o.createSpread2dArrayCol(t,e,r,i,s)),this.relativePatches.push(o.createSpread2dArrayCol(this._getRelativePath(t),e,r,i,s)),this.backPatches.unshift(o.createUpdate(t,this.get(t)))),n.spread2dArrayCol(h,e,r,i,s),this._storeUpdated(t),this)):this},get:function(t,e){if(t=this._getFullPath(t))return e===!1?this._getRef(t):a.copy(this._getRef(t))},patch:function(){throw new Error("This method is deprecated, use JSONStore.patch instead.")},applyPatch:function(t){return t="array"===a.type(t)?t:[t],t.forEach(function(t){this[t.type].apply(this,t.args)}.bind(this)),this}},i.Patch=o,e.exports=i},{"./PathListener":2,"./array":3,"./object":4,"./patch":5,"./utils":6}],2:[function(t,e,r){"use strict";function i(t){t=t||{},this.deepEqual=t.deepEqual===!0,this.listenerTree={},this.groupRefs={}}i.prototype={_copyData:function(t){return void 0===t?t:JSON.parse(JSON.stringify(t))},_removeListener:function(t,e){for(var r=0,i=t.length;r<i;){if(t[r]===e){t.splice(r,1);break}r++}},registerListener:function(t,e,r){for(var i=0,a=t.length,n=void 0,s=this.listenerTree,o=void 0;i<a;)n=t[i++],void 0===s[n]&&(s[n]={children:{},listeners:[]}),s=i===a?s[n]:s[n].children;o=s.listeners.push(e)-1,"string"==typeof r&&(void 0===this.groupRefs[r]&&(this.groupRefs[r]=[]),this.groupRefs[r].push([s.listeners,o]))},checkPath:function(t,e){for(var r=this,i=0,a=t.length,n=void 0,s=this.listenerTree,o=e;i<a&&void 0!==o&&(n=t[i++],o=o[n],void 0!==s[n]);)s[n].listeners.forEach(function(t){t(r._copyData(o))}),s=s[n].children},removeListenerByPath:function(t,e){if("function"==typeof e){for(var r=0,i=t.length,a=void 0,n=this.listenerTree;r<i;){if(a=t[r++],void 0===n[a])return;n=r===i?n[a]:n[a].children}this._removeListener(n.listeners,e)}},removeListenerByGroup:function(t){var e=this.groupRefs[t];void 0!==e&&e.forEach(function(t){t[0].splice(t[1],1)})}},e.exports=i},{}],3:[function(t,e,r){"use strict";var i=t("./utils"),a=Array.prototype.splice,n=function(t,e){t=t||0;for(var r=[],a=0;a<t;a++)r.push(void 0===e?null:i.copy(e));return r},s=function(t){var e;if(e="array"===i.type(t)&&t.length>0){for(var r=0,a=t.length;r<a;r++)if(e&="array"===i.type(t[r]),!e)return!1;return!0}return!1},o=function(t,e,r){t=t||0,e=e||0;for(var i=new Array(t),a=0;a<t;a++)i[a]=n(e,r);return i},h=function(t){var e=i.type(t);if("string"===e||"number"===e)return parseInt(t)},c=function(t,e){if("array"===i.type(t)){var r=i.type(e);if("object"===r){for(var a,n=0,s=t.length;n<s;n++){a=t[n];var o=!1;for(var h in e)if(e.hasOwnProperty(h)&&(o=a[h]===e[h],!o))break;if(o)return n}return-1}return t.indexOf(e)}},u=function(t,e){if("array"===i.type(t)){e=h(e);var r=t[e];e>0&&(t[e]=t[e-1],t[e-1]=r)}},p=function(t,e){if("array"===i.type(t)){e=h(e);var r=t[e];e<t.length-1&&(t[e]=t[e+1],t[e+1]=r)}},f=function(t,e,r,s,o){var h=[];if("array"===i.type(t)){var c=i.type(r);s===!0?a.apply(t,[e,0].concat(n(parseInt(o)||1,r))):"array"===c?a.apply(t,[e,0].concat(r)):"number"===c&&(r>0?a.apply(t,[e,0].concat(n(r))):r<0&&(h=a.apply(t,[e,Math.abs(r)])))}return h},l=function(t,e,r,a,h){var c=[],u=i.type(r);if(s(t)){var p=t[0].length;a===!0?f(t,e,n(p,r),!0,h):"number"===u?r>0?f(t,e,o(r,p)):r<0&&(c=f(t,e,r)):"array"===u&&f(t,e,r)}return c},y=function(t,e,r,a,n){var o,h=[],c=i.type(r);if(s(t)){var u=t.length,p=0;if(a===!0)for(;p<u;p++)f(t[p],e,r,!0,n);else if("number"===c)for(;p<u;p++)o=f(t[p],e,r),o.length&&h.push(o);else if("array"===c)for(;p<u;p++)f(t[p],e,r[p])}return h};e.exports={is2dArray:s,createArray:n,create2dArray:o,parseArrayIndex:h,getArrayIndexByValue:c,moveArrayItemUp:u,moveArrayItemDown:p,spreadArray:f,spread2dArrayRow:l,spread2dArrayCol:y}},{"./utils":6}],4:[function(t,e,r){"use strict";var i=t("./utils"),a=function(t,e){var r,a,n;if("object"===i.type(e)){t:for(r in t)if(t.hasOwnProperty(r)&&"object"===i.type(a=t[r])){for(n in e)if(e.hasOwnProperty(n)&&e[n]!==a[n])continue t;return r}}else for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return r},n=function(){for(var t=arguments[0],e=arguments.length,r=1;r<e;r++){var a,n=arguments[r];if("object"===i.type(n))for(a in n)n.hasOwnProperty(a)&&(t[a]=i.copy(n[a]))}return t};e.exports={hasOwnProperty:Object.prototype.hasOwnProperty,extend:n,getObjectKeyByValue:a}},{"./utils":6}],5:[function(t,e,r){"use strict";var i=t("./utils"),a={add:"add",remove:"remove",update:"update",set:"set",moveUp:"moveUp",moveDown:"moveDown",moveTo:"moveTo",exchange:"exchange",extendObject:"extendObject",spreadArray:"spreadArray",spread2dArrayCol:"spread2dArrayCol",spread2dArrayRow:"spread2dArrayRow"},n=function(t,e){return e=Array.prototype.slice.call(e),i.copy({type:t,args:e})},s={createAdd:function(t,e,r){return n(a.add,arguments)},createRemove:function(t){return n(a.remove,arguments)},createUpdate:function(t,e,r){return n(a.update,arguments)},createSet:function(t,e){return n(a.set,arguments)},createMoveUp:function(t){return n(a.moveUp,arguments)},createMoveDown:function(t){return n(a.moveDown,arguments)},createMoveTo:function(t,e,r){return n(a.moveTo,arguments)},createExchange:function(t,e){return n(a.exchange,arguments)},createExtendObject:function(t,e,r,i,s,o){return n(a.extendObject,arguments)},createSpreadArray:function(t,e,r,i,s){return n(a.spreadArray,arguments)},createSpread2dArrayRow:function(t,e,r,i,s){return n(a.spread2dArrayRow,arguments)},createSpread2dArrayCol:function(t,e,r,i,s){return n(a.spread2dArrayCol,arguments)}};e.exports=s},{"./utils":6}],6:[function(t,e,r){"use strict";var i={array:!0,object:!0},a={string:!0,number:!0},n=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},s=function(t){return i[n(t)]||!1},o=function(t){return a[n(t)]||!1},h=function(t){return s(t)?JSON.parse(JSON.stringify(t)):t};e.exports={type:n,copy:h,isReferenceType:s,isCommonKeyType:o}},{}],7:[function(t,e,r){"use strict";e.exports=t("./lib/JSONDataStore")},{"./lib/JSONDataStore":1}]},{},[7])(7)});