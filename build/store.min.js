!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.JSONStore=t()}}(function(){return function t(e,r,i){function a(n,o){if(!r[n]){if(!e[n]){var h="function"==typeof require&&require;if(!o&&h)return h(n,!0);if(s)return s(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return a(r?r:t)},u,u.exports,t,e,r,i)}return r[n].exports}for(var s="function"==typeof require&&require,n=0;n<i.length;n++)a(i[n]);return a}({1:[function(t,e,r){"use strict";function i(t){t=t||{},this.initialOptions=a.copy(t);var e=t.store,r=t.copyStore!==!1;this.copyStore=r,this.store=r?a.copy(e):e,this.cacheKeys=this._getStoreKeysMap(t.cacheKeys,this.store),this.flashKeys=this._getStoreKeysMap(t.flashKeys,this.store),this.cacheKeyPrefix=t.cacheKeyPrefix||c,this.localStorage=t.localStorage,this.patches=[],this.relativePatches=[],this.backPatches=[],this.currentPath=[],this.isDoing=!1,this.pathListener=new h({store:this.store,copyStore:r,flashKeys:this.flashKeys}),this.initialMutationActionPath=[]}var a=t("./utils"),s=t("./array"),n=t("./object"),o=t("./patch"),h=t("./PathListener"),c="JSON_STORE_CACHE_KEY_PREFIX",u=function(){};i.prototype={_storeUpdated:function(){this._updateCache(this.initialMutationActionPath[0]),this.pathListener.checkPath(this.initialMutationActionPath)},_getStoreKeysMap:function(t,e){var r={};return"array"===a.type(t)&&t.forEach(function(t){Object.hasOwnProperty.call(e,t)&&(r[t]=!0)}),r},_getRef:function(t){for(var e=this.store,r=0,i=t.length;r<i;r++)e=e[t[r]];return e},_detectPath:function(t){for(var e=[],r=this.store,i=0,o=t.length,h=void 0,c=void 0,u=void 0;i<o;i++)if(h=t[i],c=a.type(h),u=a.type(r),"object"===u)if(n.hasOwnProperty.call(h,"__value")){var p=n.getObjectKeyByValue(r,h.__value);if(!p)return[];r=r[p],e.push(p)}else{if(!n.hasOwnProperty.call(r,h))return[];r=r[h],e.push(h)}else if("array"===u)if(n.hasOwnProperty.call(h,"__value")){var f=s.getArrayIndexByValue(r,h.__value);if(!(f>-1))return[];r=r[f],e.push(f)}else{if(!n.hasOwnProperty.call(r,h))return[];r=r[h],e.push(h)}return e},_formatPath:function(t,e){var r=a.type(t);if("undefined"===r||"null"===r?t=[]:"array"!==r&&(t=[t]),e!==!1){var i=this._detectPath(t);return i.length===t.length?i:null}return t.slice()},_moveArrayItem:function(t,e){var r=this._getFullPath(t);if(!r||r.length<1)return this;var i=r.pop(),n=this._getRef(r);if("array"!==a.type(n))return this;var h=e===!0?"createMoveUp":"createMoveDown",c="createMoveUp"===h?"createMoveDown":"createMoveUp";return this.isDoing&&(this.patches.push(o[h](r.concat(i))),this.relativePatches.push(o[h](this._getRelativePath(r.concat(i)))),(e===!0&&i>0||e!==!0&&i<n.length-1)&&this.backPatches.unshift(o[c](r.concat(e===!0?i-1:i+1)))),e===!0?s.moveArrayItemUp(n,i):s.moveArrayItemDown(n,i),this._storeUpdated(),this},_getFullPath:function(t){if(a.isReferenceType(t)&&t.isFull)return t;var e=this._formatPath(this.currentPath,!1),r=e.concat(this._formatPath(t,!1)),i=this._formatPath(r);return i&&(i.isFull=!0),i},_getRelativePath:function(t){return t.slice(this.currentPath.length)},_composeCacheKey:function(t){return this.cacheKeyPrefix+"@"+t},_updateCache:function(t){this.cacheKeys[t]&&this.localStorage&&"function"==typeof this.localStorage.setItem&&this.localStorage.setItem(this._composeCacheKey(t),this.get(t))},registerPathListener:function(t,e,r,i){t=Array.isArray(t)?t:[t],this.pathListener.registerListener(t,e,r,i)},removeListenerByPath:function(t,e){t=Array.isArray(t)?t:[t],this.pathListener.removeListenerByPath(t,e)},removeListenerByGroup:function(t){this.pathListener.removeListenerByGroup(t)},removeAllListeners:function(){this.pathListener.removeAllListeners()},loadCache:function(t,e){var r=this;if(e="function"==typeof e?e:u,this.localStorage&&"function"==typeof this.localStorage.multiGet){var i=this.initialOptions.cacheKeys||[],a=i.map(function(t){return r._composeCacheKey(t)});this.localStorage.multiGet(a,function(e){var s={};a.forEach(function(t,a){var n=i[a],o=e[t];r.set(n,null===o?r.get(n):o),s[n]=e[t]}),t(s)},e)}else e("localStorage is undefined")},reInit:function(t){return i.call(this,t||this.initialOptions),this},goTo:function(t,e){if(!this.isDoing)throw new Error("You are using store.goTo outside store.do!");return e===!0?this.currentPath=this._getFullPath(t):this.currentPath=this._formatPath(t),this},do:function(t,e,r,i,a,s,n,o){var h={};if(this.isDoing=!0,"function"==typeof t)t(this,e,r,i,a,s,n,o);else{if("function"!=typeof e)throw new Error("Invalid parameter action.");e(this,r,i,a,s,n,o)}return h.patches=this.patches,h.relativePatches=this.relativePatches,h.backPatches=this.backPatches,this.patches=[],this.relativePatches=[],this.backPatches=[],this.currentPath=[],this.isDoing=!1,h},add:function(t,e,r,i){this.initialMutationActionPath=void 0!==i?i:this._formatPath(t,!1);var n=void 0,h=void 0;if(t=this._getFullPath(t),!t||!a.isReferenceType(n=this._getRef(t))||"object"===(h=a.type(n))&&!a.isCommonKeyType(r))return this;if(this.isDoing&&(this.patches.push(o.createAdd(t,e,r)),this.relativePatches.push(o.createAdd(this._getRelativePath(t),e,r)),"object"===h?this.backPatches.unshift(o.createRemove(t.concat(r))):this.backPatches.unshift(o.createUpdate(t,this.get(t),!0))),"object"===h)n[r]=e;else{var c=s.parseArrayIndex(r);void 0!==c?n.splice(c,0,e):n.push(e)}return this._storeUpdated(),this},remove:function(t,e){if(this.initialMutationActionPath=void 0!==e?e:this._formatPath(t,!1),!(t=this._getFullPath(t)))return this;if(this.isDoing&&(this.patches.push(o.createRemove(t)),this.relativePatches.push(o.createRemove(this._getRelativePath(t))),this.backPatches.unshift(o.createUpdate(t,this.get(t),!0))),t.length<1)return this.store=void 0,this;var r=t.pop(),i=this._getRef(t),s=a.type(i);return"array"===s?i.splice(r,1):"object"===s&&delete i[r],this._storeUpdated(),this},update:function(t,e,r,i){this.initialMutationActionPath=void 0!==i?i:this._formatPath(t,!1),t=this._formatPath(t,!1);var a=void 0,s=this._getFullPath(t);return s?(this.isDoing&&(this.patches.push(o.createUpdate(s,e)),this.relativePatches.push(o.createUpdate(this._getRelativePath(s),e)),this.backPatches.unshift(o.createUpdate(s,this.get(s)))),a=s.pop(),void 0!==a?this._getRef(s)[a]=e:this.store=e,this._storeUpdated(),this):r===!0&&t.length>0?(a=t.pop(),this.add(t,e,a,this.initialMutationActionPath)):this},set:function(t,e){return this.update(t,e,!0,this._formatPath(t,!1))},moveUp:function(t){return this.initialMutationActionPath=this._formatPath(t,!1),this._moveArrayItem(t,!0)},moveDown:function(t){return this.initialMutationActionPath=this._formatPath(t,!1),this._moveArrayItem(t)},moveTo:function(t,e,r){var i=this._formatPath(t,!1),s=this._formatPath(e,!1);return t=this._getFullPath(t),e=this._getFullPath(e),t&&e&&a.isReferenceType(this._getRef(e))?(this.add(e,this._getRef(t),r,s),this.remove(t,i),this):this},exchange:function(t,e){var r=this._formatPath(t,!1),i=this._formatPath(e,!1);if(t=this._getFullPath(t),e=this._getFullPath(e),t&&e){var a=this._getRef(t),s=this.get(e);this.update(t,s,!1,r),this.update(e,a,!1,i)}return this},extendObject:function(t,e,r,i,s,h,c){this.initialMutationActionPath=this._formatPath(t,!1);var u=void 0;return(t=this._getFullPath(t))&&"object"===a.type(u=this._getRef(t))?(this.isDoing&&(this.patches.push(o.createExtendObject.apply(this,arguments)),this.relativePatches.push(o.createExtendObject(this._getRelativePath(t),e,r,i,s,h,c)),this.backPatches.push(o.createUpdate(t,this.get(t)))),n.extend(u,e,r,i,s,h,c),this._storeUpdated(),this):this},spreadArray:function(t,e,r,i,n){this.initialMutationActionPath=this._formatPath(t,!1);var h=void 0;return(t=this._getFullPath(t))&&"array"===a.type(h=this._getRef(t))?(e="number"==typeof e?e:h.length,"number"!==a.type(e)?this:(this.isDoing&&(this.patches.push(o.createSpreadArray(t,e,r,i,n)),this.relativePatches.push(o.createSpreadArray(this._getRelativePath(t),e,r,i,n)),this.backPatches.unshift(o.createUpdate(t,this.get(t)))),s.spreadArray(h,e,r,i,n),this._storeUpdated(),this)):this},spread2dArrayRow:function(t,e,r,i,n){this.initialMutationActionPath=this._formatPath(t,!1);var h=void 0;return(t=this._getFullPath(t))&&s.is2dArray(h=this._getRef(t))&&"number"===a.type(e)?(e="number"==typeof e?e:h.length,"number"!==a.type(e)?this:(this.isDoing&&(this.patches.push(o.createSpread2dArrayRow(t,e,r,i,n)),this.relativePatches.push(o.createSpread2dArrayRow(this._getRelativePath(t),e,r,i,n)),this.backPatches.unshift(o.createUpdate(t,this.get(t)))),s.spread2dArrayRow(h,e,r,i,n),this._storeUpdated(),this)):this},spread2dArrayCol:function(t,e,r,i,n){this.initialMutationActionPath=this._formatPath(t,!1);var h=void 0;return(t=this._getFullPath(t))&&s.is2dArray(h=this._getRef(t))&&"number"===a.type(e)?(e="number"==typeof e?e:h[0].length,"number"!==a.type(e)?this:(this.isDoing&&(this.patches.push(o.createSpread2dArrayCol(t,e,r,i,n)),this.relativePatches.push(o.createSpread2dArrayCol(this._getRelativePath(t),e,r,i,n)),this.backPatches.unshift(o.createUpdate(t,this.get(t)))),s.spread2dArrayCol(h,e,r,i,n),this._storeUpdated(),this)):this},get:function(t){if(t=this._getFullPath(t))return this.copyStore?a.copy(this._getRef(t)):this._getRef(t)},patch:function(){throw new Error("This method is deprecated, use JSONStore.patch instead.")},applyPatch:function(t){return t="array"===a.type(t)?t:[t],t.forEach(function(t){this[t.type].apply(this,t.args)}.bind(this)),this}},i.Patch=o,e.exports=i},{"./PathListener":2,"./array":3,"./object":4,"./patch":5,"./utils":6}],2:[function(t,e,r){"use strict";function i(t){t=t||{},this.deepEqual=t.deepEqual===!0,this.copyStore=t.copyStore,this.listenerTree={},this.groupRefs={},this.store=t.store||{},this.flashKeys=t.flashKeys||{}}i.prototype={_copyData:function(t){return void 0===t?t:this.copyStore?JSON.parse(JSON.stringify(t)):t},_removeListener:function(t,e){for(var r=0,i=t.length;r<i;)t[r]===e&&(t[r]=null),r++},registerListener:function(t,e,r,i){r="string"==typeof r?r:null,i=null===r?r!==!1:i!==!1;for(var a=0,s=t.length,n=void 0,o=this.listenerTree,h=void 0;a<s;)n=t[a++],void 0===o[n]&&(o[n]={children:{},listeners:[]}),o=a===s?o[n]:o[n].children;h=o.listeners.push(e)-1,null!==r&&(void 0===this.groupRefs[r]&&(this.groupRefs[r]=[]),this.groupRefs[r].push([o.listeners,h])),i&&this.checkPath(t)},checkPath:function(t){for(var e=this,r=0,i=t.length,a=void 0,s=this.listenerTree,n=this.store;r<i&&void 0!==n&&(a=t[r++],n=n[a],void 0!==s[a]);)s[a].listeners.forEach(function(t){"function"==typeof t&&t(e._copyData(n))}),s=s[a].children;1===t.length&&this.flashKeys[t[0]]&&(this.store[t[0]]=null)},removeAllListeners:function(){this.listenerTree={},this.groupRefs={}},removeListenerByPath:function(t,e){if("function"==typeof e){for(var r=0,i=t.length,a=void 0,s=this.listenerTree;r<i;){if(a=t[r++],void 0===s[a])return;s=r===i?s[a]:s[a].children}this._removeListener(s.listeners,e)}},removeListenerByGroup:function(t){var e=this.groupRefs[t];void 0!==e&&e.forEach(function(t){"function"==typeof t[0][t[1]]&&(t[0][t[1]]=null)})}},e.exports=i},{}],3:[function(t,e,r){"use strict";var i=t("./utils"),a=Array.prototype.splice,s=function(t,e){t=t||0;for(var r=[],a=0;a<t;a++)r.push(void 0===e?null:i.copy(e));return r},n=function(t){var e;if(e="array"===i.type(t)&&t.length>0){for(var r=0,a=t.length;r<a;r++)if(e&="array"===i.type(t[r]),!e)return!1;return!0}return!1},o=function(t,e,r){t=t||0,e=e||0;for(var i=new Array(t),a=0;a<t;a++)i[a]=s(e,r);return i},h=function(t){var e=i.type(t);if("string"===e||"number"===e)return parseInt(t)},c=function(t,e){if("array"===i.type(t)){var r=i.type(e);if("object"===r){for(var a,s=0,n=t.length;s<n;s++){a=t[s];var o=!1;for(var h in e)if(e.hasOwnProperty(h)&&(o=a[h]===e[h],!o))break;if(o)return s}return-1}return t.indexOf(e)}},u=function(t,e){if("array"===i.type(t)){e=h(e);var r=t[e];e>0&&(t[e]=t[e-1],t[e-1]=r)}},p=function(t,e){if("array"===i.type(t)){e=h(e);var r=t[e];e<t.length-1&&(t[e]=t[e+1],t[e+1]=r)}},f=function(t,e,r,n,o){var h=[];if("array"===i.type(t)){var c=i.type(r);n===!0?a.apply(t,[e,0].concat(s(parseInt(o)||1,r))):"array"===c?a.apply(t,[e,0].concat(r)):"number"===c&&(r>0?a.apply(t,[e,0].concat(s(r))):r<0&&(h=a.apply(t,[e,Math.abs(r)])))}return h},l=function(t,e,r,a,h){var c=[],u=i.type(r);if(n(t)){var p=t[0].length;a===!0?f(t,e,s(p,r),!0,h):"number"===u?r>0?f(t,e,o(r,p)):r<0&&(c=f(t,e,r)):"array"===u&&f(t,e,r)}return c},y=function(t,e,r,a,s){var o,h=[],c=i.type(r);if(n(t)){var u=t.length,p=0;if(a===!0)for(;p<u;p++)f(t[p],e,r,!0,s);else if("number"===c)for(;p<u;p++)o=f(t[p],e,r),o.length&&h.push(o);else if("array"===c)for(;p<u;p++)f(t[p],e,r[p])}return h};e.exports={is2dArray:n,createArray:s,create2dArray:o,parseArrayIndex:h,getArrayIndexByValue:c,moveArrayItemUp:u,moveArrayItemDown:p,spreadArray:f,spread2dArrayRow:l,spread2dArrayCol:y}},{"./utils":6}],4:[function(t,e,r){"use strict";var i=t("./utils"),a=function(t,e){var r,a,s;if("object"===i.type(e)){t:for(r in t)if(t.hasOwnProperty(r)&&"object"===i.type(a=t[r])){for(s in e)if(e.hasOwnProperty(s)&&e[s]!==a[s])continue t;return r}}else for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return r},s=function(){for(var t=arguments[0],e=arguments.length,r=1;r<e;r++){var a,s=arguments[r];if("object"===i.type(s))for(a in s)s.hasOwnProperty(a)&&(t[a]=i.copy(s[a]))}return t};e.exports={hasOwnProperty:Object.prototype.hasOwnProperty,extend:s,getObjectKeyByValue:a}},{"./utils":6}],5:[function(t,e,r){"use strict";var i=t("./utils"),a={add:"add",remove:"remove",update:"update",set:"set",moveUp:"moveUp",moveDown:"moveDown",moveTo:"moveTo",exchange:"exchange",extendObject:"extendObject",spreadArray:"spreadArray",spread2dArrayCol:"spread2dArrayCol",spread2dArrayRow:"spread2dArrayRow"},s=function(t,e){return e=Array.prototype.slice.call(e),i.copy({type:t,args:e})},n={createAdd:function(t,e,r){return s(a.add,arguments)},createRemove:function(t){return s(a.remove,arguments)},createUpdate:function(t,e,r){return s(a.update,arguments)},createSet:function(t,e){return s(a.set,arguments)},createMoveUp:function(t){return s(a.moveUp,arguments)},createMoveDown:function(t){return s(a.moveDown,arguments)},createMoveTo:function(t,e,r){return s(a.moveTo,arguments)},createExchange:function(t,e){return s(a.exchange,arguments)},createExtendObject:function(t,e,r,i,n,o){return s(a.extendObject,arguments)},createSpreadArray:function(t,e,r,i,n){return s(a.spreadArray,arguments)},createSpread2dArrayRow:function(t,e,r,i,n){return s(a.spread2dArrayRow,arguments)},createSpread2dArrayCol:function(t,e,r,i,n){return s(a.spread2dArrayCol,arguments)}};e.exports=n},{"./utils":6}],6:[function(t,e,r){"use strict";var i={array:!0,object:!0},a={string:!0,number:!0},s=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},n=function(t){return i[s(t)]||!1},o=function(t){return a[s(t)]||!1},h=function(t){return n(t)?JSON.parse(JSON.stringify(t)):t};e.exports={type:s,copy:h,isReferenceType:n,isCommonKeyType:o}},{}],7:[function(t,e,r){"use strict";e.exports=t("./lib/JSONDataStore")},{"./lib/JSONDataStore":1}]},{},[7])(7)});