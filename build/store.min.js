!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.JSONStore=t()}}(function(){return function t(e,r,a){function i(s,h){if(!r[s]){if(!e[s]){var o="function"==typeof require&&require;if(!h&&o)return o(s,!0);if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};e[s][0].call(u.exports,function(t){var r=e[s][1][t];return i(r?r:t)},u,u.exports,t,e,r,a)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";function a(t){t=t||{},this.initialOptions=i.copy(t);var e=t.store,r=t.copyStore!==!1;this.store=r?i.copy(e):e,this.patches=[],this.relativePatches=[],this.backPatches=[],this.currentPath=[],this.isDoing=!1}var i=t("./utils"),n=t("./array"),s=t("./object"),h={add:"add",remove:"remove",update:"update",moveUp:"moveUp",moveDown:"moveDown",moveTo:"moveTo",exchange:"exchange",extendObject:"extendObject",spreadArray:"spreadArray",spread2dArrayCol:"spread2dArrayCol",spread2dArrayRow:"spread2dArrayRow"},o=function(t,e){return e=Array.prototype.slice.call(e),i.copy({type:t,args:e})},c={createAdd:function(t,e,r){return o(h.add,arguments)},createRemove:function(t){return o(h.remove,arguments)},createUpdate:function(t,e,r){return o(h.update,arguments)},createMoveUp:function(t){return o(h.moveUp,arguments)},createMoveDown:function(t){return o(h.moveDown,arguments)},createMoveTo:function(t,e,r){return o(h.moveTo,arguments)},createExchange:function(t,e){return o(h.exchange,arguments)},createExtendObject:function(t,e,r,a,i,n){return o(h.extendObject,arguments)},createSpreadArray:function(t,e,r){return o(h.spreadArray,arguments)},createSpread2dArrayRow:function(t,e,r){return o(h.spread2dArrayRow,arguments)},createSpread2dArrayCol:function(t,e,r){return o(h.spread2dArrayCol,arguments)}};a.prototype={_getRef:function(t){for(var e=this.store,r=0,a=t.length;r<a;r++)e=e[t[r]];return e},_detectPath:function(t){for(var e,r,a,h=[],o=this.store,c=0,u=t.length;c<u;c++)if(e=t[c],r=i.type(e),a=i.type(o),"object"===a)if(s.hasOwnProperty.call(e,"__value")){var p=s.getObjectKeyByValue(o,e.__value);if(!p)return[];o=o[p],h.push(p)}else{if(!s.hasOwnProperty.call(o,e))return[];o=o[e],h.push(e)}else if("array"===a)if(s.hasOwnProperty.call(e,"__value")){var f=n.getArrayIndexByValue(o,e.__value);if(!(f>-1))return[];o=o[f],h.push(f)}else{if(!s.hasOwnProperty.call(o,e))return[];o=o[e],h.push(e)}return h},_formatPath:function(t,e){var r=i.type(t);if("undefined"===r||"null"===r?t=[]:"array"!==r&&(t=[t]),e!==!1){var a=this._detectPath(t);return a.length===t.length?a:null}return t},_moveArrayItem:function(t,e){var r=this._getFullPath(t);if(!r||r.length<1)return this;var a=r.pop(),s=this._getRef(r);if("array"!==i.type(s))return this;var h=e===!0?"createMoveUp":"createMoveDown",o="createMoveUp"===h?"createMoveDown":"createMoveUp";return this.isDoing&&(this.patches.push(c[h](r.concat(a))),this.relativePatches.push(c[h](this._getRelativePath(r.concat(a)))),(e===!0&&a>0||e!==!0&&a<s.length-1)&&this.backPatches.unshift(c[o](r.concat(e===!0?a-1:a+1)))),e===!0?n.moveArrayItemUp(s,a):n.moveArrayItemDown(s,a),this},_getFullPath:function(t){var e=this._formatPath(this.currentPath,!1),r=e.concat(this._formatPath(t,!1));return this._formatPath(r)},_getRelativePath:function(t){return t.slice(this.currentPath.length)},reInit:function(t){return a.call(this,t||this.initialOptions),this},goTo:function(t,e){if(!this.isDoing)throw new Error("You are using store.goTo outside store.do!");return e===!0?this.currentPath=this._formatPath(this.currentPath.concat(this._formatPath(t,!1))):this.currentPath=this._formatPath(t),this},do:function(t,e,r){"function"==typeof t&&(r=e,e=t,t="");var a={};return this.isDoing=!0,e(this,r,t),a.patches=this.patches,a.relativePatches=this.relativePatches,a.backPatches=this.backPatches,this.patches=[],this.relativePatches=[],this.backPatches=[],this.currentPath=[],this.isDoing=!1,a},add:function(t,e,r){var a,s;if(t=this._getFullPath(t),!t||!i.isReferenceType(a=this._getRef(t))||"object"===(s=i.type(a))&&!i.isCommonKeyType(r))return this;if(this.isDoing&&(this.patches.push(c.createAdd(t,e,r)),this.relativePatches.push(c.createAdd(this._getRelativePath(t),e,r)),"object"===s?this.backPatches.unshift(c.createRemove(t.concat(r))):this.backPatches.unshift(c.createUpdate(t,this.get(t),!0))),"object"===s)a[r]=e;else{var h=n.parseArrayIndex(r);void 0!==h?a.splice(h,0,e):a.push(e)}return this},remove:function(t){if(!(t=this._getFullPath(t)))return this;if(this.isDoing&&(this.patches.push(c.createRemove(t)),this.relativePatches.push(c.createRemove(this._getRelativePath(t))),this.backPatches.unshift(c.createUpdate(t,this.get(t),!0))),t.length<1)return this.store=void 0,this;var e=t.pop(),r=this._getRef(t),a=i.type(r);return"array"===a?r.splice(e,1):"object"===a&&delete r[e],this},update:function(t,e,r){t=this._formatPath(t,!1);var a,i=this._formatPath(t);return i?(this.isDoing&&(this.patches.push(c.createUpdate(i,e)),this.relativePatches.push(c.createUpdate(this._getRelativePath(i),e)),this.backPatches.unshift(c.createUpdate(i,this.get(i)))),a=i.pop(),void 0!==a?this._getRef(i)[a]=e:this.store=e,this):r===!0&&t.length>0?(a=t.pop(),this.add(t,e,a)):this},set:function(t,e){return this.update(t,e,!0)},moveUp:function(t){return this._moveArrayItem(t,!0)},moveDown:function(t){return this._moveArrayItem(t)},moveTo:function(t,e,r){return t=this._getFullPath(t),e=this._getFullPath(e),t&&e&&i.isReferenceType(this._getRef(e))?(this.add(e,this._getRef(t),r),this.remove(t),this):this},exchange:function(t,e){if(t=this._formatPath(t),e=this._formatPath(e),t&&e){var r=this._getRef(t),a=this.get(e);this.update(t,a),this.update(e,r)}return this},extendObject:function(t,e,r,a,n,h){var o;return(t=this._formatPath(t))&&"object"===i.type(o=this._getRef(t))?(this.isDoing&&(this.patches.push(c.createExtendObject.apply(this,arguments)),this.relativePatches.push(c.createExtendObject(this._getRelativePath(t),e,r,a,n,h)),this.backPatches.push(c.createUpdate(t,this.get(t)))),s.extend(o,e,r,a,n,h),this):this},spreadArray:function(t,e,r){var a;return(t=this._formatPath(t))&&"array"===i.type(a=this._getRef(t))?(e=e||a.length,"number"!==i.type(e)?this:(this.isDoing&&(this.patches.push(c.createSpreadArray(t,e,r)),this.relativePatches.push(c.createSpreadArray(this._getRelativePath(t),e,r)),this.backPatches.unshift(c.createUpdate(t,this.get(t)))),n.spreadArray(a,e,r),this)):this},spread2dArrayRow:function(t,e,r){var a;return(t=this._formatPath(t))&&n.is2dArray(a=this._getRef(t))&&"number"===i.type(e)?(e=e||a.length,"number"!==i.type(e)?this:(this.isDoing&&(this.patches.push(c.createSpread2dArrayRow(t,e,r)),this.relativePatches.push(c.createSpread2dArrayRow(this._getRelativePath(t),e,r)),this.backPatches.unshift(c.createUpdate(t,this.get(t)))),n.spread2dArrayRow(a,e,r),this)):this},spread2dArrayCol:function(t,e,r){var a;return(t=this._formatPath(t))&&n.is2dArray(a=this._getRef(t))&&"number"===i.type(e)?(e=e||a.length,"number"!==i.type(e)?this:(this.isDoing&&(this.patches.push(c.createSpread2dArrayCol(t,e,r)),this.relativePatches.push(c.createSpread2dArrayCol(this._getRelativePath(t),e,r)),this.backPatches.unshift(c.createUpdate(t,this.get(t)))),n.spread2dArrayCol(a,e,r),this)):this},get:function(t,e){if(t=this._getFullPath(t))return e===!1?this._getRef(t):i.copy(this._getRef(t))},patch:c,applyPatch:function(t){return t="array"===i.type(t)?t:[t],t.forEach(function(t){this[t.type].apply(this,t.args)}.bind(this)),this}},a.patch=c,e.exports=a},{"./array":2,"./object":3,"./utils":4}],2:[function(t,e,r){"use strict";var a=t("./utils"),i=Array.prototype.splice,n=function(t,e){t=t||0;for(var r=[],a=0;a<t;a++)r.push(void 0===e?null:e);return r},s=function(t){var e;if(e="array"===a.type(t)&&t.length>0){for(var r=0,i=t.length;r<i;r++)if(e&="array"===a.type(t[r]),!e)return!1;return!0}return!1},h=function(t,e,r){t=t||0,e=e||0;for(var a=new Array(t),i=0;i<t;i++)a[i]=n(e,r);return a},o=function(t){var e=a.type(t);if("string"===e||"number"===e)return parseInt(t)},c=function(t,e){if("array"===a.type(t)){var r=a.type(e);if("object"===r){for(var i,n=0,s=t.length;n<s;n++){i=t[n];var h=!1;for(var o in e)if(e.hasOwnProperty(o)&&(h=i[o]===e[o],!h))break;if(h)return n}return-1}return t.indexOf(e)}},u=function(t,e){if("array"===a.type(t)){e=o(e);var r=t[e];e>0&&(t[e]=t[e-1],t[e-1]=r)}},p=function(t,e){if("array"===a.type(t)){e=o(e);var r=t[e];e<t.length-1&&(t[e]=t[e+1],t[e+1]=r)}},f=function(t,e,r){var s=[];if("array"===a.type(t)){var h=a.type(r);"array"===h?i.apply(t,[e,0].concat(r)):"number"===h&&(r>0?i.apply(t,[e,0].concat(n(r))):r<0&&(s=i.apply(t,[e,Math.abs(r)])))}return s},y=function(t,e,r){var i=[],n=a.type(r);if(s(t)){var o=t[0].length;"number"===n?r>0?f(t,e,h(r,o)):r<0&&(i=f(t,e,r)):"array"===n&&f(t,e,r)}return i},l=function(t,e,r){var i,n=[],h=a.type(r);if(s(t)){var o=t.length,c=0;if("number"===h)for(;c<o;c++)i=f(t[c],e,r),i.length&&n.push(i);else if("array"===h)for(;c<o;c++)f(t[c],e,r[c])}return n};e.exports={is2dArray:s,createArray:n,create2dArray:h,parseArrayIndex:o,getArrayIndexByValue:c,moveArrayItemUp:u,moveArrayItemDown:p,spreadArray:f,spread2dArrayRow:y,spread2dArrayCol:l}},{"./utils":4}],3:[function(t,e,r){"use strict";var a=t("./utils"),i=function(t,e){var r,i,n;if("object"===a.type(e)){t:for(r in t)if(t.hasOwnProperty(r)&&"object"===a.type(i=t[r])){for(n in e)if(e.hasOwnProperty(n)&&e[n]!==i[n])continue t;return r}}else for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return r},n=function(){for(var t=arguments[0],e=arguments.length,r=1;r<e;r++){var i,n=arguments[r];if("object"===a.type(n))for(i in n)n.hasOwnProperty(i)&&(t[i]=a.copy(n[i]))}return t};e.exports={hasOwnProperty:Object.prototype.hasOwnProperty,extend:n,getObjectKeyByValue:i}},{"./utils":4}],4:[function(t,e,r){"use strict";var a={array:!0,object:!0},i={string:!0,number:!0},n=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},s=function(t){return a[n(t)]||!1},h=function(t){return i[n(t)]||!1},o=function(t){return s(t)?JSON.parse(JSON.stringify(t)):t};e.exports={type:n,copy:o,isReferenceType:s,isCommonKeyType:h}},{}],5:[function(t,e,r){"use strict";e.exports=t("./lib/JSONDataStore")},{"./lib/JSONDataStore":1}]},{},[5])(5)});