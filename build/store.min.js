!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.JSONStore=t()}}(function(){return function t(e,r,a){function i(s,h){if(!r[s]){if(!e[s]){var o="function"==typeof require&&require;if(!h&&o)return o(s,!0);if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};e[s][0].call(u.exports,function(t){var r=e[s][1][t];return i(r?r:t)},u,u.exports,t,e,r,a)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(t,e,r){"use strict";function a(t){t=t||{},this.initialOptions=i.copy(t);var e=t.store,r=t.copyStore!==!1;this.store=r?i.copy(e):e,this.patches=[],this.relativePatches=[],this.backPatches=[],this.currentPath=[],this.isDoing=!1}var i=t("./utils"),n=t("./array"),s=t("./object"),h=t("./patch");a.prototype={_getRef:function(t){for(var e=this.store,r=0,a=t.length;r<a;r++)e=e[t[r]];return e},_detectPath:function(t){for(var e,r,a,h=[],o=this.store,c=0,u=t.length;c<u;c++)if(e=t[c],r=i.type(e),a=i.type(o),"object"===a)if(s.hasOwnProperty.call(e,"__value")){var p=s.getObjectKeyByValue(o,e.__value);if(!p)return[];o=o[p],h.push(p)}else{if(!s.hasOwnProperty.call(o,e))return[];o=o[e],h.push(e)}else if("array"===a)if(s.hasOwnProperty.call(e,"__value")){var f=n.getArrayIndexByValue(o,e.__value);if(!(f>-1))return[];o=o[f],h.push(f)}else{if(!s.hasOwnProperty.call(o,e))return[];o=o[e],h.push(e)}return h},_formatPath:function(t,e){var r=i.type(t);if("undefined"===r||"null"===r?t=[]:"array"!==r&&(t=[t]),e!==!1){var a=this._detectPath(t);return a.length===t.length?a:null}return t},_moveArrayItem:function(t,e){var r=this._getFullPath(t);if(!r||r.length<1)return this;var a=r.pop(),s=this._getRef(r);if("array"!==i.type(s))return this;var o=e===!0?"createMoveUp":"createMoveDown",c="createMoveUp"===o?"createMoveDown":"createMoveUp";return this.isDoing&&(this.patches.push(h[o](r.concat(a))),this.relativePatches.push(h[o](this._getRelativePath(r.concat(a)))),(e===!0&&a>0||e!==!0&&a<s.length-1)&&this.backPatches.unshift(h[c](r.concat(e===!0?a-1:a+1)))),e===!0?n.moveArrayItemUp(s,a):n.moveArrayItemDown(s,a),this},_getFullPath:function(t){var e=this._formatPath(this.currentPath,!1),r=e.concat(this._formatPath(t,!1));return this._formatPath(r)},_getRelativePath:function(t){return t.slice(this.currentPath.length)},reInit:function(t){return a.call(this,t||this.initialOptions),this},goTo:function(t,e){if(!this.isDoing)throw new Error("You are using store.goTo outside store.do!");return e===!0?this.currentPath=this._getFullPath(t):this.currentPath=this._formatPath(t),this},do:function(t,e,r,a,i,n,s,h){var o={};if(this.isDoing=!0,"function"==typeof t)t(this,e,r,a,i,n,s,h);else{if("function"!=typeof e)throw new Error("Invalid parameter action.");e(this,r,a,i,n,s,h)}return o.patches=this.patches,o.relativePatches=this.relativePatches,o.backPatches=this.backPatches,this.patches=[],this.relativePatches=[],this.backPatches=[],this.currentPath=[],this.isDoing=!1,o},add:function(t,e,r){var a,s;if(t=this._getFullPath(t),!t||!i.isReferenceType(a=this._getRef(t))||"object"===(s=i.type(a))&&!i.isCommonKeyType(r))return this;if(this.isDoing&&(this.patches.push(h.createAdd(t,e,r)),this.relativePatches.push(h.createAdd(this._getRelativePath(t),e,r)),"object"===s?this.backPatches.unshift(h.createRemove(t.concat(r))):this.backPatches.unshift(h.createUpdate(t,this.get(t),!0))),"object"===s)a[r]=e;else{var o=n.parseArrayIndex(r);void 0!==o?a.splice(o,0,e):a.push(e)}return this},remove:function(t){if(!(t=this._getFullPath(t)))return this;if(this.isDoing&&(this.patches.push(h.createRemove(t)),this.relativePatches.push(h.createRemove(this._getRelativePath(t))),this.backPatches.unshift(h.createUpdate(t,this.get(t),!0))),t.length<1)return this.store=void 0,this;var e=t.pop(),r=this._getRef(t),a=i.type(r);return"array"===a?r.splice(e,1):"object"===a&&delete r[e],this},update:function(t,e,r){t=this._formatPath(t,!1);var a,i=this._getFullPath(t);return i?(this.isDoing&&(this.patches.push(h.createUpdate(i,e)),this.relativePatches.push(h.createUpdate(this._getRelativePath(i),e)),this.backPatches.unshift(h.createUpdate(i,this.get(i)))),a=i.pop(),void 0!==a?this._getRef(i)[a]=e:this.store=e,this):r===!0&&t.length>0?(a=t.pop(),this.add(t,e,a)):this},set:function(t,e){return this.update(t,e,!0)},moveUp:function(t){return this._moveArrayItem(t,!0)},moveDown:function(t){return this._moveArrayItem(t)},moveTo:function(t,e,r){return t=this._getFullPath(t),e=this._getFullPath(e),t&&e&&i.isReferenceType(this._getRef(e))?(this.add(e,this._getRef(t),r),this.remove(t),this):this},exchange:function(t,e){if(t=this._getFullPath(t),e=this._getFullPath(e),t&&e){var r=this._getRef(t),a=this.get(e);this.update(t,a),this.update(e,r)}return this},extendObject:function(t,e,r,a,n,o,c){var u;return(t=this._getFullPath(t))&&"object"===i.type(u=this._getRef(t))?(this.isDoing&&(this.patches.push(h.createExtendObject.apply(this,arguments)),this.relativePatches.push(h.createExtendObject(this._getRelativePath(t),e,r,a,n,o,c)),this.backPatches.push(h.createUpdate(t,this.get(t)))),s.extend(u,e,r,a,n,o,c),this):this},spreadArray:function(t,e,r,a,s){var o;return(t=this._getFullPath(t))&&"array"===i.type(o=this._getRef(t))?(e="number"==typeof e?e:o.length,"number"!==i.type(e)?this:(this.isDoing&&(this.patches.push(h.createSpreadArray(t,e,r,a,s)),this.relativePatches.push(h.createSpreadArray(this._getRelativePath(t),e,r,a,s)),this.backPatches.unshift(h.createUpdate(t,this.get(t)))),n.spreadArray(o,e,r,a,s),this)):this},spread2dArrayRow:function(t,e,r,a,s){var o;return(t=this._getFullPath(t))&&n.is2dArray(o=this._getRef(t))&&"number"===i.type(e)?(e="number"==typeof e?e:o.length,"number"!==i.type(e)?this:(this.isDoing&&(this.patches.push(h.createSpread2dArrayRow(t,e,r,a,s)),this.relativePatches.push(h.createSpread2dArrayRow(this._getRelativePath(t),e,r,a,s)),this.backPatches.unshift(h.createUpdate(t,this.get(t)))),n.spread2dArrayRow(o,e,r,a,s),this)):this},spread2dArrayCol:function(t,e,r,a,s){var o;return(t=this._getFullPath(t))&&n.is2dArray(o=this._getRef(t))&&"number"===i.type(e)?(e="number"==typeof e?e:o[0].length,"number"!==i.type(e)?this:(this.isDoing&&(this.patches.push(h.createSpread2dArrayCol(t,e,r,a,s)),this.relativePatches.push(h.createSpread2dArrayCol(this._getRelativePath(t),e,r,a,s)),this.backPatches.unshift(h.createUpdate(t,this.get(t)))),n.spread2dArrayCol(o,e,r,a,s),this)):this},get:function(t,e){if(t=this._getFullPath(t))return e===!1?this._getRef(t):i.copy(this._getRef(t))},patch:function(){throw new Error("This method is deprecated, use JSONStore.patch instead.")},applyPatch:function(t){return t="array"===i.type(t)?t:[t],t.forEach(function(t){this[t.type].apply(this,t.args)}.bind(this)),this}},a.Patch=h,e.exports=a},{"./array":2,"./object":3,"./patch":4,"./utils":5}],2:[function(t,e,r){"use strict";var a=t("./utils"),i=Array.prototype.splice,n=function(t,e){t=t||0;for(var r=[],i=0;i<t;i++)r.push(void 0===e?null:a.copy(e));return r},s=function(t){var e;if(e="array"===a.type(t)&&t.length>0){for(var r=0,i=t.length;r<i;r++)if(e&="array"===a.type(t[r]),!e)return!1;return!0}return!1},h=function(t,e,r){t=t||0,e=e||0;for(var a=new Array(t),i=0;i<t;i++)a[i]=n(e,r);return a},o=function(t){var e=a.type(t);if("string"===e||"number"===e)return parseInt(t)},c=function(t,e){if("array"===a.type(t)){var r=a.type(e);if("object"===r){for(var i,n=0,s=t.length;n<s;n++){i=t[n];var h=!1;for(var o in e)if(e.hasOwnProperty(o)&&(h=i[o]===e[o],!h))break;if(h)return n}return-1}return t.indexOf(e)}},u=function(t,e){if("array"===a.type(t)){e=o(e);var r=t[e];e>0&&(t[e]=t[e-1],t[e-1]=r)}},p=function(t,e){if("array"===a.type(t)){e=o(e);var r=t[e];e<t.length-1&&(t[e]=t[e+1],t[e+1]=r)}},f=function(t,e,r,s,h){var o=[];if("array"===a.type(t)){var c=a.type(r);s===!0?i.apply(t,[e,0].concat(n(parseInt(h)||1,r))):"array"===c?i.apply(t,[e,0].concat(r)):"number"===c&&(r>0?i.apply(t,[e,0].concat(n(r))):r<0&&(o=i.apply(t,[e,Math.abs(r)])))}return o},l=function(t,e,r,i,o){var c=[],u=a.type(r);if(s(t)){var p=t[0].length;i===!0?f(t,e,n(p,r),!0,o):"number"===u?r>0?f(t,e,h(r,p)):r<0&&(c=f(t,e,r)):"array"===u&&f(t,e,r)}return c},y=function(t,e,r,i,n){var h,o=[],c=a.type(r);if(s(t)){var u=t.length,p=0;if(i===!0)for(;p<u;p++)f(t[p],e,r,!0,n);else if("number"===c)for(;p<u;p++)h=f(t[p],e,r),h.length&&o.push(h);else if("array"===c)for(;p<u;p++)f(t[p],e,r[p])}return o};e.exports={is2dArray:s,createArray:n,create2dArray:h,parseArrayIndex:o,getArrayIndexByValue:c,moveArrayItemUp:u,moveArrayItemDown:p,spreadArray:f,spread2dArrayRow:l,spread2dArrayCol:y}},{"./utils":5}],3:[function(t,e,r){"use strict";var a=t("./utils"),i=function(t,e){var r,i,n;if("object"===a.type(e)){t:for(r in t)if(t.hasOwnProperty(r)&&"object"===a.type(i=t[r])){for(n in e)if(e.hasOwnProperty(n)&&e[n]!==i[n])continue t;return r}}else for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return r},n=function(){for(var t=arguments[0],e=arguments.length,r=1;r<e;r++){var i,n=arguments[r];if("object"===a.type(n))for(i in n)n.hasOwnProperty(i)&&(t[i]=a.copy(n[i]))}return t};e.exports={hasOwnProperty:Object.prototype.hasOwnProperty,extend:n,getObjectKeyByValue:i}},{"./utils":5}],4:[function(t,e,r){"use strict";var a=t("./utils"),i={add:"add",remove:"remove",update:"update",set:"set",moveUp:"moveUp",moveDown:"moveDown",moveTo:"moveTo",exchange:"exchange",extendObject:"extendObject",spreadArray:"spreadArray",spread2dArrayCol:"spread2dArrayCol",spread2dArrayRow:"spread2dArrayRow"},n=function(t,e){return e=Array.prototype.slice.call(e),a.copy({type:t,args:e})},s={createAdd:function(t,e,r){return n(i.add,arguments)},createRemove:function(t){return n(i.remove,arguments)},createUpdate:function(t,e,r){return n(i.update,arguments)},createSet:function(t,e){return n(i.set,arguments)},createMoveUp:function(t){return n(i.moveUp,arguments)},createMoveDown:function(t){return n(i.moveDown,arguments)},createMoveTo:function(t,e,r){return n(i.moveTo,arguments)},createExchange:function(t,e){return n(i.exchange,arguments)},createExtendObject:function(t,e,r,a,s,h){return n(i.extendObject,arguments)},createSpreadArray:function(t,e,r,a,s){return n(i.spreadArray,arguments)},createSpread2dArrayRow:function(t,e,r,a,s){return n(i.spread2dArrayRow,arguments)},createSpread2dArrayCol:function(t,e,r,a,s){return n(i.spread2dArrayCol,arguments)}};e.exports=s},{"./utils":5}],5:[function(t,e,r){"use strict";var a={array:!0,object:!0},i={string:!0,number:!0},n=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},s=function(t){return a[n(t)]||!1},h=function(t){return i[n(t)]||!1},o=function(t){return s(t)?JSON.parse(JSON.stringify(t)):t};e.exports={type:n,copy:o,isReferenceType:s,isCommonKeyType:h}},{}],6:[function(t,e,r){"use strict";e.exports=t("./lib/JSONDataStore")},{"./lib/JSONDataStore":1}]},{},[6])(6)});